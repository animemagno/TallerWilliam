<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Control de Ingresos - Mototaxis</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f0f2f5;
            color: #333;
            line-height: 1.4;
            padding: 15px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 0 8px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #27ae60, #219653);
            color: white;
            padding: 12px;
            text-align: center;
        }
        
        h1 {
            font-size: 18px;
            margin-bottom: 3px;
        }
        
        .tabs {
            display: flex;
            background-color: #f1f1f1;
            border-bottom: 1px solid #ddd;
            flex-wrap: wrap;
        }
        
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            font-size: 13px;
            min-width: 120px;
        }
        
        .tab.active {
            background-color: white;
            border-bottom: 3px solid #27ae60;
            color: #27ae60;
        }
        
        .tab-content {
            display: none;
            padding: 12px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 12px;
        }
        
        label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: #2d3748;
            font-size: 13px;
        }
        
        input, select, textarea {
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 13px;
            width: 100%;
        }
        
        textarea {
            resize: vertical;
            min-height: 60px;
        }
        
        .btn {
            padding: 6px 10px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin-right: 6px;
            font-size: 13px;
        }
        
        .btn-primary {
            background-color: #27ae60;
            color: white;
        }
        
        .btn-primary:hover {
            background-color: #219653;
        }
        
        .btn-success {
            background-color: #3498db;
            color: white;
        }
        
        .btn-success:hover {
            background-color: #2980b9;
        }
        
        .btn-warning {
            background-color: #f39c12;
            color: white;
        }
        
        .btn-warning:hover {
            background-color: #e67e22;
        }
        
        .btn-info {
            background-color: #17a2b8;
            color: white;
        }
        
        .btn-info:hover {
            background-color: #138496;
        }
        
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        
        .btn-secondary:hover {
            background-color: #5a6268;
        }
        
        .fila-compacta {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .monto-input {
            width: 120px;
            flex-shrink: 0;
        }
        
        .fecha-input {
            width: 120px;
            flex-shrink: 0;
        }
        
        .equipo-select, .cliente-select {
            flex: 1;
            min-width: 150px;
        }
        
        .resumen-equipos, .resumen-clientes {
            margin-top: 15px;
            border-top: 1px solid #ddd;
            padding: 12px;
        }
        
        .resumen-equipos h2, .resumen-clientes h2 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .lista-equipos, .lista-clientes {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .equipo-card, .cliente-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px;
            font-size: 12px;
        }
        
        .equipo-header, .cliente-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .equipo-numero, .cliente-nombre {
            font-weight: bold;
            color: #27ae60;
            font-size: 14px;
        }
        
        .equipo-total, .cliente-total {
            font-weight: bold;
            color: #e74c3c;
        }
        
        .equipo-info, .cliente-info {
            color: #6c757d;
            margin-bottom: 3px;
        }
        
        .ingresos-list {
            margin-top: 15px;
            border-top: 1px solid #ddd;
            padding: 12px;
        }
        
        .ingresos-list h2 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .lista-ingresos {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .ingreso-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }
        
        .ingreso-item:hover {
            background-color: #f8f9fa;
        }
        
        .ingreso-fecha {
            width: 80px;
            color: #666;
            font-size: 11px;
            flex-shrink: 0;
        }
        
        .ingreso-equipo {
            width: 80px;
            font-weight: bold;
            color: #27ae60;
            flex-shrink: 0;
        }
        
        .ingreso-cliente {
            width: 100px;
            font-weight: bold;
            color: #3498db;
            flex-shrink: 0;
        }
        
        .ingreso-monto {
            width: 80px;
            font-weight: bold;
            color: #e74c3c;
            text-align: right;
            flex-shrink: 0;
        }
        
        .ingreso-info {
            flex: 1;
            min-width: 0;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            color: #6c757d;
            font-size: 12px;
        }
        
        .delete-btn {
            background: none;
            border: none;
            color: #dc3545;
            cursor: pointer;
            font-size: 12px;
            padding: 2px;
            flex-shrink: 0;
        }
        
        .edit-btn {
            background: none;
            border: none;
            color: #3498db;
            cursor: pointer;
            font-size: 12px;
            padding: 2px;
            flex-shrink: 0;
            margin-right: 5px;
        }
        
        .empty-message {
            text-align: center;
            color: #6c757d;
            font-style: italic;
            padding: 12px;
            font-size: 13px;
        }
        
        .total-general {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 5px;
            margin-top: 10px;
            text-align: center;
            font-weight: bold;
            color: #27ae60;
        }
        
        .fecha-hoy-btn {
            margin-left: 8px;
            padding: 4px 8px;
            font-size: 11px;
        }
        
        /* Estilos para la vista de dep√≥sitos por equipo */
        .depositos-equipo, .depositos-cliente {
            margin-top: 15px;
        }
        
        .depositos-equipo h2, .depositos-cliente h2 {
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .depositos-lista {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        
        @media (min-width: 768px) {
            .depositos-lista {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        .deposito-equipo-card, .deposito-cliente-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 12px;
            font-size: 13px;
        }
        
        .deposito-equipo-header, .deposito-cliente-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #dee2e6;
        }
        
        .deposito-equipo-numero, .deposito-cliente-nombre {
            font-weight: bold;
            color: #27ae60;
            font-size: 16px;
        }
        
        .deposito-equipo-total, .deposito-cliente-total {
            font-weight: bold;
            color: #e74c3c;
            font-size: 14px;
        }
        
        .deposito-item {
            display: flex;
            justify-content: space-between;
            padding: 4px 0;
            border-bottom: 1px dashed #dee2e6;
        }
        
        .deposito-fecha {
            color: #666;
        }
        
        .deposito-monto {
            font-weight: bold;
            color: #2d3748;
        }
        
        .deposito-total {
            margin-top: 8px;
            padding-top: 8px;
            border-top: 2px solid #27ae60;
            font-weight: bold;
            text-align: right;
            color: #27ae60;
        }
        
        .imprimir-btn {
            margin-top: 10px;
            background-color: #6c757d;
            color: white;
        }
        
        .imprimir-btn:hover {
            background-color: #5a6268;
        }
        
        /* Estilos para impresi√≥n */
        @media print {
            body * {
                visibility: hidden;
            }
            .depositos-print, .depositos-print * {
                visibility: visible;
            }
            .depositos-print {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none !important;
            }
        }
        
        .filtros {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .filtro-group {
            flex: 1;
            min-width: 150px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Control de Ingresos - Mototaxis</h1>
        </header>
        
        <div class="tabs">
            <div class="tab active" data-tab="ingresos">Registrar Ingreso</div>
            <div class="tab" data-tab="equipos">Gestionar Equipos</div>
            <div class="tab" data-tab="clientes">Gestionar Clientes</div>
            <div class="tab" data-tab="historial">Historial de Ingresos</div>
            <div class="tab" data-tab="depositos-equipos">Dep√≥sitos por Equipo</div>
            <div class="tab" data-tab="depositos-clientes">Dep√≥sitos por Cliente</div>
        </div>
        
        <!-- Pesta√±a de Ingresos -->
        <div class="tab-content active" id="ingresos">
            <div class="form-group">
                <label for="fecha">Fecha:</label>
                <div class="fila-compacta">
                    <input type="date" id="fecha" class="fecha-input">
                    <button class="btn btn-warning fecha-hoy-btn" id="fecha-hoy">Hoy</button>
                </div>
            </div>
            
            <div class="form-group">
                <label for="equipo-ingreso">Equipo:</label>
                <select id="equipo-ingreso">
                    <option value="">Seleccione un equipo</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="cliente-ingreso">Cliente:</label>
                <select id="cliente-ingreso">
                    <option value="">Seleccione un cliente</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="monto">Monto ($):</label>
                <input type="number" id="monto" class="monto-input" placeholder="0.00" min="0" step="0.01">
            </div>
            
            <div class="form-group">
                <label for="descripcion">Descripci√≥n (opcional):</label>
                <textarea id="descripcion" placeholder="Descripci√≥n del ingreso..."></textarea>
            </div>
            
            <div>
                <button class="btn btn-primary" id="guardar-ingreso">Registrar Ingreso</button>
            </div>
            
            <div class="resumen-equipos">
                <h2>Resumen por Equipo</h2>
                <div class="lista-equipos" id="resumen-equipos">
                    <!-- Aqu√≠ se mostrar√° el resumen por equipo -->
                </div>
                <div class="total-general" id="total-general">
                    Total General: $0.00
                </div>
            </div>
            
            <div class="resumen-clientes">
                <h2>Resumen por Cliente</h2>
                <div class="lista-clientes" id="resumen-clientes">
                    <!-- Aqu√≠ se mostrar√° el resumen por cliente -->
                </div>
            </div>
        </div>
        
        <!-- Pesta√±a de Equipos -->
        <div class="tab-content" id="equipos">
            <h2>Registrar Nuevo Equipo</h2>
            
            <div class="form-group">
                <label for="numero-equipo">N√∫mero de Equipo:</label>
                <input type="number" id="numero-equipo" placeholder="Ej: 1, 2, 3..." min="1">
            </div>
            
            <div class="form-group">
                <label for="placa">Placa:</label>
                <input type="text" id="placa" placeholder="Ej: P123456">
            </div>
            
            <div class="form-group">
                <label for="nombre">Nombre del Conductor:</label>
                <input type="text" id="nombre" placeholder="Nombre completo">
            </div>
            
            <div class="form-group">
                <label for="dui">DUI:</label>
                <input type="text" id="dui" placeholder="Ej: 12345678-9">
            </div>
            
            <div>
                <button class="btn btn-success" id="guardar-equipo">Guardar Equipo</button>
            </div>
            
            <div class="ingresos-list">
                <h2>Equipos Registrados</h2>
                <div class="lista-ingresos" id="lista-equipos">
                    <!-- Aqu√≠ se mostrar√°n los equipos -->
                </div>
            </div>
        </div>
        
        <!-- Pesta√±a de Clientes -->
        <div class="tab-content" id="clientes">
            <h2>Registrar Nuevo Cliente</h2>
            
            <div class="form-group">
                <label for="nombre-cliente">Nombre del Cliente:</label>
                <input type="text" id="nombre-cliente" placeholder="Nombre completo o raz√≥n social">
            </div>
            
            <div class="form-group">
                <label for="telefono-cliente">Tel√©fono:</label>
                <input type="text" id="telefono-cliente" placeholder="N√∫mero de tel√©fono">
            </div>
            
            <div class="form-group">
                <label for="direccion-cliente">Direcci√≥n:</label>
                <input type="text" id="direccion-cliente" placeholder="Direcci√≥n completa">
            </div>
            
            <div class="form-group">
                <label for="notas-cliente">Notas (opcional):</label>
                <textarea id="notas-cliente" placeholder="Informaci√≥n adicional del cliente..."></textarea>
            </div>
            
            <div>
                <button class="btn btn-success" id="guardar-cliente">Guardar Cliente</button>
            </div>
            
            <div class="ingresos-list">
                <h2>Clientes Registrados</h2>
                <div class="lista-ingresos" id="lista-clientes">
                    <!-- Aqu√≠ se mostrar√°n los clientes -->
                </div>
            </div>
        </div>
        
        <!-- Pesta√±a de Historial -->
        <div class="tab-content" id="historial">
            <h2>Historial de Ingresos</h2>
            
            <div class="filtros">
                <div class="filtro-group">
                    <label for="filtro-equipo">Filtrar por Equipo:</label>
                    <select id="filtro-equipo">
                        <option value="">Todos los equipos</option>
                    </select>
                </div>
                
                <div class="filtro-group">
                    <label for="filtro-cliente">Filtrar por Cliente:</label>
                    <select id="filtro-cliente">
                        <option value="">Todos los clientes</option>
                    </select>
                </div>
                
                <div class="filtro-group">
                    <label for="filtro-fecha">Filtrar por Fecha:</label>
                    <input type="month" id="filtro-fecha">
                </div>
            </div>
            
            <div class="lista-ingresos" id="historial-ingresos">
                <!-- Aqu√≠ se mostrar√° el historial -->
            </div>
        </div>
        
        <!-- Pesta√±a de Dep√≥sitos por Equipo -->
        <div class="tab-content" id="depositos-equipos">
            <h2>Dep√≥sitos por Equipo</h2>
            <button class="btn btn-info no-print" id="imprimir-todos-equipos">Imprimir Todos</button>
            
            <div class="filtros">
                <div class="filtro-group">
                    <label for="filtro-equipo-depositos">Filtrar por Equipo:</label>
                    <select id="filtro-equipo-depositos">
                        <option value="">Todos los equipos</option>
                    </select>
                </div>
            </div>
            
            <div class="depositos-equipo">
                <div class="depositos-lista" id="depositos-lista-equipos">
                    <!-- Aqu√≠ se mostrar√°n los dep√≥sitos por equipo -->
                </div>
            </div>
        </div>
        
        <!-- Pesta√±a de Dep√≥sitos por Cliente -->
        <div class="tab-content" id="depositos-clientes">
            <h2>Dep√≥sitos por Cliente</h2>
            <button class="btn btn-info no-print" id="imprimir-todos-clientes">Imprimir Todos</button>
            
            <div class="filtros">
                <div class="filtro-group">
                    <label for="filtro-cliente-depositos">Filtrar por Cliente:</label>
                    <select id="filtro-cliente-depositos">
                        <option value="">Todos los clientes</option>
                    </select>
                </div>
            </div>
            
            <div class="depositos-cliente">
                <div class="depositos-lista" id="depositos-lista-clientes">
                    <!-- Aqu√≠ se mostrar√°n los dep√≥sitos por cliente -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Configuraci√≥n de Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDh074AarXaYCc-Htw-lsCeIc_95QQNSnY",
            authDomain: "tallerwilliam-732b3.firebaseapp.com",
            projectId: "tallerwilliam-732b3",
            storageBucket: "tallerwilliam-732b3.firebasestorage.app",
            messagingSenderId: "822262666247",
            appId: "1:822262666247:web:6680487bbf1108006b86a2"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.addEventListener('DOMContentLoaded', function() {
            // Configurar pesta√±as
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Remover clase active de todas las pesta√±as y contenidos
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(tc => tc.classList.remove('active'));
                    
                    // Agregar clase active a la pesta√±a y contenido seleccionados
                    this.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    // Actualizar selectores si es necesario
                    if (tabId === 'ingresos') {
                        actualizarSelectoresEquipos();
                        actualizarSelectoresClientes();
                        actualizarResumenEquipos();
                        actualizarResumenClientes();
                    } else if (tabId === 'depositos-equipos') {
                        cargarDepositosPorEquipo();
                        actualizarFiltroEquipos('filtro-equipo-depositos');
                    } else if (tabId === 'depositos-clientes') {
                        cargarDepositosPorCliente();
                        actualizarFiltroClientes('filtro-cliente-depositos');
                    } else if (tabId === 'historial') {
                        actualizarFiltroEquipos('filtro-equipo');
                        actualizarFiltroClientes('filtro-cliente');
                        cargarHistorialIngresos();
                    }
                });
            });
            
            // Funci√≥n para obtener fecha actual en formato YYYY-MM-DD
            function obtenerFechaHoy() {
                const fechaActual = new Date();
                const a√±o = fechaActual.getFullYear();
                const mes = String(fechaActual.getMonth() + 1).padStart(2, '0');
                const dia = String(fechaActual.getDate()).padStart(2, '0');
                return `${a√±o}-${mes}-${dia}`;
            }
            
            // Funci√≥n para formatear fecha de YYYY-MM-DD a dd/mm/aaaa
            function formatearFecha(fechaISO) {
                const [a√±o, mes, dia] = fechaISO.split('-');
                return `${dia}/${mes}/${a√±o}`;
            }
            
            // Establecer fecha actual en el formulario
            const fechaInput = document.getElementById('fecha');
            fechaInput.value = obtenerFechaHoy();
            
            // Bot√≥n para establecer fecha de hoy
            document.getElementById('fecha-hoy').addEventListener('click', function() {
                fechaInput.value = obtenerFechaHoy();
            });
            
            // Elementos del DOM
            const guardarIngresoBtn = document.getElementById('guardar-ingreso');
            const guardarEquipoBtn = document.getElementById('guardar-equipo');
            const guardarClienteBtn = document.getElementById('guardar-cliente');
            const imprimirTodosEquiposBtn = document.getElementById('imprimir-todos-equipos');
            const imprimirTodosClientesBtn = document.getElementById('imprimir-todos-clientes');
            
            // Inicializar la aplicaci√≥n
            inicializarApp();
            
            // Event listeners
            guardarIngresoBtn.addEventListener('click', guardarIngreso);
            guardarEquipoBtn.addEventListener('click', guardarEquipo);
            guardarClienteBtn.addEventListener('click', guardarCliente);
            imprimirTodosEquiposBtn.addEventListener('click', () => window.print());
            imprimirTodosClientesBtn.addEventListener('click', () => window.print());
            
            // Filtros
            document.getElementById('filtro-equipo').addEventListener('change', cargarHistorialIngresos);
            document.getElementById('filtro-cliente').addEventListener('change', cargarHistorialIngresos);
            document.getElementById('filtro-fecha').addEventListener('change', cargarHistorialIngresos);
            document.getElementById('filtro-equipo-depositos').addEventListener('change', cargarDepositosPorEquipo);
            document.getElementById('filtro-cliente-depositos').addEventListener('change', cargarDepositosPorCliente);
            
            // Funci√≥n para inicializar la aplicaci√≥n
            async function inicializarApp() {
                // Cargar datos desde Firebase
                await cargarDatosFirebase();
                
                // Cargar datos iniciales
                actualizarSelectoresEquipos();
                actualizarSelectoresClientes();
                actualizarResumenEquipos();
                actualizarResumenClientes();
                cargarListaEquipos();
                cargarListaClientes();
                cargarHistorialIngresos();
            }
            
            // Funci√≥n para cargar datos desde Firebase
            async function cargarDatosFirebase() {
                try {
                    // Cargar equipos
                    const equiposSnapshot = await db.collection('equipos').get();
                    const equipos = [];
                    equiposSnapshot.forEach(doc => {
                        equipos.push({ id: doc.id, ...doc.data() });
                    });
                    localStorage.setItem('equiposMototaxis', JSON.stringify(equipos));
                    
                    // Cargar clientes
                    const clientesSnapshot = await db.collection('clientes').get();
                    const clientes = [];
                    clientesSnapshot.forEach(doc => {
                        clientes.push({ id: doc.id, ...doc.data() });
                    });
                    localStorage.setItem('clientesMototaxis', JSON.stringify(clientes));
                    
                    // Cargar ingresos
                    const ingresosSnapshot = await db.collection('ingresos').get();
                    const ingresos = [];
                    ingresosSnapshot.forEach(doc => {
                        ingresos.push({ id: doc.id, ...doc.data() });
                    });
                    localStorage.setItem('ingresosMototaxis', JSON.stringify(ingresos));
                } catch (error) {
                    console.error("Error cargando datos desde Firebase:", error);
                    // Si no hay datos en Firebase, usar datos locales
                    if (!localStorage.getItem('equiposMototaxis')) {
                        localStorage.setItem('equiposMototaxis', JSON.stringify([]));
                    }
                    if (!localStorage.getItem('clientesMototaxis')) {
                        localStorage.setItem('clientesMototaxis', JSON.stringify([]));
                    }
                    if (!localStorage.getItem('ingresosMototaxis')) {
                        localStorage.setItem('ingresosMototaxis', JSON.stringify([]));
                    }
                }
            }
            
            // Funci√≥n para guardar datos en Firebase
            async function guardarEnFirebase(coleccion, datos, id = null) {
                try {
                    if (id) {
                        await db.collection(coleccion).doc(id.toString()).set(datos);
                    } else {
                        await db.collection(coleccion).add(datos);
                    }
                    return true;
                } catch (error) {
                    console.error("Error guardando en Firebase:", error);
                    return false;
                }
            }
            
            // Funci√≥n para eliminar datos de Firebase
            async function eliminarDeFirebase(coleccion, id) {
                try {
                    await db.collection(coleccion).doc(id.toString()).delete();
                    return true;
                } catch (error) {
                    console.error("Error eliminando de Firebase:", error);
                    return false;
                }
            }
            
            // Funci√≥n para guardar un nuevo equipo
            async function guardarEquipo() {
                const numero = parseInt(document.getElementById('numero-equipo').value) || 0;
                const placa = document.getElementById('placa').value.trim();
                const nombre = document.getElementById('nombre').value.trim();
                const dui = document.getElementById('dui').value.trim();
                
                // Validaciones m√≠nimas - solo el n√∫mero es obligatorio
                if (numero <= 0) {
                    alert('Por favor, ingrese un n√∫mero de equipo v√°lido.');
                    return;
                }
                
                // Obtener equipos actuales
                const equipos = JSON.parse(localStorage.getItem('equiposMototaxis')) || [];
                
                // Verificar si ya existe el n√∫mero de equipo
                if (equipos.some(equipo => equipo.numero === numero)) {
                    alert('Ya existe un equipo con ese n√∫mero.');
                    return;
                }
                
                // Crear nuevo equipo
                const nuevoEquipo = {
                    numero: numero,
                    placa: placa || 'No registrada',
                    nombre: nombre || 'No registrado',
                    dui: dui || 'No registrado'
                };
                
                // Guardar equipo en Firebase
                const id = Date.now().toString();
                const exito = await guardarEnFirebase('equipos', nuevoEquipo, id);
                
                if (exito) {
                    // Guardar equipo localmente
                    nuevoEquipo.id = id;
                    equipos.push(nuevoEquipo);
                    localStorage.setItem('equiposMototaxis', JSON.stringify(equipos));
                    
                    // Actualizar interfaces
                    actualizarSelectoresEquipos();
                    cargarListaEquipos();
                    
                    // Limpiar formulario
                    document.getElementById('numero-equipo').value = '';
                    document.getElementById('placa').value = '';
                    document.getElementById('nombre').value = '';
                    document.getElementById('dui').value = '';
                    
                    alert('Equipo registrado correctamente.');
                } else {
                    alert('Error al guardar el equipo. Los datos se guardar√°n localmente.');
                    
                    // Guardar solo localmente si falla Firebase
                    nuevoEquipo.id = id;
                    equipos.push(nuevoEquipo);
                    localStorage.setItem('equiposMototaxis', JSON.stringify(equipos));
                    
                    // Actualizar interfaces
                    actualizarSelectoresEquipos();
                    cargarListaEquipos();
                    
                    // Limpiar formulario
                    document.getElementById('numero-equipo').value = '';
                    document.getElementById('placa').value = '';
                    document.getElementById('nombre').value = '';
                    document.getElementById('dui').value = '';
                }
            }
            
            // Funci√≥n para guardar un nuevo cliente
            async function guardarCliente() {
                const nombre = document.getElementById('nombre-cliente').value.trim();
                const telefono = document.getElementById('telefono-cliente').value.trim();
                const direccion = document.getElementById('direccion-cliente').value.trim();
                const notas = document.getElementById('notas-cliente').value.trim();
                
                // Validaciones m√≠nimas - solo el nombre es obligatorio
                if (!nombre) {
                    alert('Por favor, ingrese el nombre del cliente.');
                    return;
                }
                
                // Obtener clientes actuales
                const clientes = JSON.parse(localStorage.getItem('clientesMototaxis')) || [];
                
                // Verificar si ya existe el cliente
                if (clientes.some(cliente => cliente.nombre.toLowerCase() === nombre.toLowerCase())) {
                    alert('Ya existe un cliente con ese nombre.');
                    return;
                }
                
                // Crear nuevo cliente
                const nuevoCliente = {
                    nombre: nombre,
                    telefono: telefono || 'No registrado',
                    direccion: direccion || 'No registrada',
                    notas: notas || 'Sin notas'
                };
                
                // Guardar cliente en Firebase
                const id = Date.now().toString();
                const exito = await guardarEnFirebase('clientes', nuevoCliente, id);
                
                if (exito) {
                    // Guardar cliente localmente
                    nuevoCliente.id = id;
                    clientes.push(nuevoCliente);
                    localStorage.setItem('clientesMototaxis', JSON.stringify(clientes));
                    
                    // Actualizar interfaces
                    actualizarSelectoresClientes();
                    cargarListaClientes();
                    
                    // Limpiar formulario
                    document.getElementById('nombre-cliente').value = '';
                    document.getElementById('telefono-cliente').value = '';
                    document.getElementById('direccion-cliente').value = '';
                    document.getElementById('notas-cliente').value = '';
                    
                    alert('Cliente registrado correctamente.');
                } else {
                    alert('Error al guardar el cliente. Los datos se guardar√°n localmente.');
                    
                    // Guardar solo localmente si falla Firebase
                    nuevoCliente.id = id;
                    clientes.push(nuevoCliente);
                    localStorage.setItem('clientesMototaxis', JSON.stringify(clientes));
                    
                    // Actualizar interfaces
                    actualizarSelectoresClientes();
                    cargarListaClientes();
                    
                    // Limpiar formulario
                    document.getElementById('nombre-cliente').value = '';
                    document.getElementById('telefono-cliente').value = '';
                    document.getElementById('direccion-cliente').value = '';
                    document.getElementById('notas-cliente').value = '';
                }
            }
            
            // Funci√≥n para guardar un ingreso
            async function guardarIngreso() {
                const equipoId = document.getElementById('equipo-ingreso').value;
                const clienteId = document.getElementById('cliente-ingreso').value;
                const monto = parseFloat(document.getElementById('monto').value) || 0;
                const fecha = document.getElementById('fecha').value;
                const descripcion = document.getElementById('descripcion').value.trim();
                
                // Validaciones
                if (!equipoId) {
                    alert('Por favor, seleccione un equipo.');
                    return;
                }
                
                if (!clienteId) {
                    alert('Por favor, seleccione un cliente.');
                    return;
                }
                
                if (monto <= 0) {
                    alert('Por favor, ingrese un monto v√°lido.');
                    return;
                }
                
                if (!fecha) {
                    alert('Por favor, seleccione una fecha.');
                    return;
                }
                
                // Obtener equipos y clientes para encontrar informaci√≥n
                const equipos = JSON.parse(localStorage.getItem('equiposMototaxis')) || [];
                const clientes = JSON.parse(localStorage.getItem('clientesMototaxis')) || [];
                
                const equipo = equipos.find(e => e.id === equipoId);
                const cliente = clientes.find(c => c.id === clienteId);
                
                if (!equipo) {
                    alert('Equipo no encontrado.');
                    return;
                }
                
                if (!cliente) {
                    alert('Cliente no encontrado.');
                    return;
                }
                
                // Crear objeto ingreso
                const ingreso = {
                    fecha: formatearFecha(fecha), // Guardar fecha formateada
                    fechaISO: fecha, // Guardar tambi√©n en formato ISO para ordenamiento
                    equipoId: equipoId,
                    equipoNumero: equipo.numero,
                    equipoNombre: equipo.nombre,
                    clienteId: clienteId,
                    clienteNombre: cliente.nombre,
                    monto: monto,
                    descripcion: descripcion || 'Sin descripci√≥n'
                };
                
                // Guardar en Firebase
                const id = Date.now().toString();
                const exito = await guardarEnFirebase('ingresos', ingreso, id);
                
                if (exito) {
                    // Guardar en localStorage
                    ingreso.id = id;
                    let ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                    ingresos.push(ingreso);
                    localStorage.setItem('ingresosMototaxis', JSON.stringify(ingresos));
                    
                    // Actualizar interfaces
                    actualizarResumenEquipos();
                    actualizarResumenClientes();
                    cargarHistorialIngresos();
                    
                    // Limpiar formulario (solo el monto y descripci√≥n, mantener fecha, equipo y cliente)
                    document.getElementById('monto').value = '';
                    document.getElementById('descripcion').value = '';
                    
                    alert('Ingreso registrado correctamente.');
                } else {
                    alert('Error al guardar el ingreso. Los datos se guardar√°n localmente.');
                    
                    // Guardar solo localmente si falla Firebase
                    ingreso.id = id;
                    let ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                    ingresos.push(ingreso);
                    localStorage.setItem('ingresosMototaxis', JSON.stringify(ingresos));
                    
                    // Actualizar interfaces
                    actualizarResumenEquipos();
                    actualizarResumenClientes();
                    cargarHistorialIngresos();
                    
                    // Limpiar formulario (solo el monto y descripci√≥n, mantener fecha, equipo y cliente)
                    document.getElementById('monto').value = '';
                    document.getElementById('descripcion').value = '';
                }
            }
            
            // Funci√≥n para actualizar selectores de equipos
            function actualizarSelectoresEquipos() {
                const equipos = JSON.parse(localStorage.getItem('equiposMototaxis')) || [];
                const selector = document.getElementById('equipo-ingreso');
                
                // Limpiar opciones (excepto la primera)
                selector.innerHTML = '<option value="">Seleccione un equipo</option>';
                
                // Agregar equipos
                equipos.forEach(equipo => {
                    const option = document.createElement('option');
                    option.value = equipo.id;
                    option.textContent = `Equipo ${equipo.numero} - ${equipo.nombre}`;
                    selector.appendChild(option);
                });
            }
            
            // Funci√≥n para actualizar selectores de clientes
            function actualizarSelectoresClientes() {
                const clientes = JSON.parse(localStorage.getItem('clientesMototaxis')) || [];
                const selector = document.getElementById('cliente-ingreso');
                
                // Limpiar opciones (excepto la primera)
                selector.innerHTML = '<option value="">Seleccione un cliente</option>';
                
                // Agregar clientes
                clientes.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.nombre;
                    selector.appendChild(option);
                });
            }
            
            // Funci√≥n para actualizar filtros de equipos
            function actualizarFiltroEquipos(selectorId) {
                const equipos = JSON.parse(localStorage.getItem('equiposMototaxis')) || [];
                const selector = document.getElementById(selectorId);
                
                // Limpiar opciones (excepto la primera)
                selector.innerHTML = '<option value="">Todos los equipos</option>';
                
                // Agregar equipos
                equipos.forEach(equipo => {
                    const option = document.createElement('option');
                    option.value = equipo.id;
                    option.textContent = `Equipo ${equipo.numero} - ${equipo.nombre}`;
                    selector.appendChild(option);
                });
            }
            
            // Funci√≥n para actualizar filtros de clientes
            function actualizarFiltroClientes(selectorId) {
                const clientes = JSON.parse(localStorage.getItem('clientesMototaxis')) || [];
                const selector = document.getElementById(selectorId);
                
                // Limpiar opciones (excepto la primera)
                selector.innerHTML = '<option value="">Todos los clientes</option>';
                
                // Agregar clientes
                clientes.forEach(cliente => {
                    const option = document.createElement('option');
                    option.value = cliente.id;
                    option.textContent = cliente.nombre;
                    selector.appendChild(option);
                });
            }
            
            // Funci√≥n para actualizar resumen de equipos
            function actualizarResumenEquipos() {
                const equipos = JSON.parse(localStorage.getItem('equiposMototaxis')) || [];
                const ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                const resumenContainer = document.getElementById('resumen-equipos');
                const totalGeneral = document.getElementById('total-general');
                
                // Limpiar resumen
                resumenContainer.innerHTML = '';
                
                if (equipos.length === 0) {
                    resumenContainer.innerHTML = '<div class="empty-message">No hay equipos registrados.</div>';
                    totalGeneral.textContent = 'Total General: $0.00';
                    return;
                }
                
                let totalGeneralMonto = 0;
                
                // Calcular total por equipo
                equipos.forEach(equipo => {
                    const ingresosEquipo = ingresos.filter(ingreso => ingreso.equipoId === equipo.id);
                    const totalEquipo = ingresosEquipo.reduce((sum, ingreso) => sum + ingreso.monto, 0);
                    totalGeneralMonto += totalEquipo;
                    
                    const equipoCard = document.createElement('div');
                    equipoCard.className = 'equipo-card';
                    equipoCard.innerHTML = `
                        <div class="equipo-header">
                            <div class="equipo-numero">Equipo ${equipo.numero}</div>
                            <div class="equipo-total">$${totalEquipo.toFixed(2)}</div>
                        </div>
                        <div class="equipo-info">${equipo.nombre}</div>
                        <div class="equipo-info">${equipo.placa}</div>
                        <div class="equipo-info">${equipo.dui}</div>
                    `;
                    
                    resumenContainer.appendChild(equipoCard);
                });
                
                totalGeneral.textContent = `Total General: $${totalGeneralMonto.toFixed(2)}`;
            }
            
            // Funci√≥n para actualizar resumen de clientes
            function actualizarResumenClientes() {
                const clientes = JSON.parse(localStorage.getItem('clientesMototaxis')) || [];
                const ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                const resumenContainer = document.getElementById('resumen-clientes');
                
                // Limpiar resumen
                resumenContainer.innerHTML = '';
                
                if (clientes.length === 0) {
                    resumenContainer.innerHTML = '<div class="empty-message">No hay clientes registrados.</div>';
                    return;
                }
                
                // Calcular total por cliente
                clientes.forEach(cliente => {
                    const ingresosCliente = ingresos.filter(ingreso => ingreso.clienteId === cliente.id);
                    const totalCliente = ingresosCliente.reduce((sum, ingreso) => sum + ingreso.monto, 0);
                    
                    if (totalCliente > 0) {
                        const clienteCard = document.createElement('div');
                        clienteCard.className = 'cliente-card';
                        clienteCard.innerHTML = `
                            <div class="cliente-header">
                                <div class="cliente-nombre">${cliente.nombre}</div>
                                <div class="cliente-total">$${totalCliente.toFixed(2)}</div>
                            </div>
                            <div class="cliente-info">${cliente.telefono}</div>
                            <div class="cliente-info">${cliente.direccion}</div>
                        `;
                        
                        resumenContainer.appendChild(clienteCard);
                    }
                });
                
                if (resumenContainer.children.length === 0) {
                    resumenContainer.innerHTML = '<div class="empty-message">No hay ingresos registrados para ning√∫n cliente.</div>';
                }
            }
            
            // Funci√≥n para cargar lista de equipos
            function cargarListaEquipos() {
                const equipos = JSON.parse(localStorage.getItem('equiposMototaxis')) || [];
                const listaContainer = document.getElementById('lista-equipos');
                
                // Limpiar lista
                listaContainer.innerHTML = '';
                
                if (equipos.length === 0) {
                    listaContainer.innerHTML = '<div class="empty-message">No hay equipos registrados.</div>';
                    return;
                }
                
                // Ordenar equipos por n√∫mero
                equipos.sort((a, b) => a.numero - b.numero);
                
                equipos.forEach(equipo => {
                    const equipoItem = document.createElement('div');
                    equipoItem.className = 'ingreso-item';
                    equipoItem.innerHTML = `
                        <div class="ingreso-equipo">Equipo ${equipo.numero}</div>
                        <div class="ingreso-info">${equipo.nombre} - ${equipo.placa} - ${equipo.dui}</div>
                        <button class="delete-btn" data-id="${equipo.id}">üóëÔ∏è</button>
                    `;
                    
                    listaContainer.appendChild(equipoItem);
                });
                
                // Agregar event listeners a los botones de eliminar
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        eliminarEquipo(id);
                    });
                });
            }
            
            // Funci√≥n para cargar lista de clientes
            function cargarListaClientes() {
                const clientes = JSON.parse(localStorage.getItem('clientesMototaxis')) || [];
                const listaContainer = document.getElementById('lista-clientes');
                
                // Limpiar lista
                listaContainer.innerHTML = '';
                
                if (clientes.length === 0) {
                    listaContainer.innerHTML = '<div class="empty-message">No hay clientes registrados.</div>';
                    return;
                }
                
                // Ordenar clientes por nombre
                clientes.sort((a, b) => a.nombre.localeCompare(b.nombre));
                
                clientes.forEach(cliente => {
                    const clienteItem = document.createElement('div');
                    clienteItem.className = 'ingreso-item';
                    clienteItem.innerHTML = `
                        <div class="ingreso-cliente">${cliente.nombre}</div>
                        <div class="ingreso-info">${cliente.telefono} - ${cliente.direccion}</div>
                        <button class="delete-btn" data-id="${cliente.id}">üóëÔ∏è</button>
                    `;
                    
                    listaContainer.appendChild(clienteItem);
                });
                
                // Agregar event listeners a los botones de eliminar
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        eliminarCliente(id);
                    });
                });
            }
            
            // Funci√≥n para cargar historial de ingresos
            function cargarHistorialIngresos() {
                const ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                const historialContainer = document.getElementById('historial-ingresos');
                const filtroEquipo = document.getElementById('filtro-equipo').value;
                const filtroCliente = document.getElementById('filtro-cliente').value;
                const filtroFecha = document.getElementById('filtro-fecha').value;
                
                // Limpiar historial
                historialContainer.innerHTML = '';
                
                // Filtrar ingresos
                let ingresosFiltrados = ingresos;
                
                if (filtroEquipo) {
                    ingresosFiltrados = ingresosFiltrados.filter(ingreso => ingreso.equipoId === filtroEquipo);
                }
                
                if (filtroCliente) {
                    ingresosFiltrados = ingresosFiltrados.filter(ingreso => ingreso.clienteId === filtroCliente);
                }
                
                if (filtroFecha) {
                    ingresosFiltrados = ingresosFiltrados.filter(ingreso => {
                        const fechaIngreso = new Date(ingreso.fechaISO);
                        const a√±o = fechaIngreso.getFullYear();
                        const mes = String(fechaIngreso.getMonth() + 1).padStart(2, '0');
                        return `${a√±o}-${mes}` === filtroFecha;
                    });
                }
                
                if (ingresosFiltrados.length === 0) {
                    historialContainer.innerHTML = '<div class="empty-message">No hay ingresos registrados con los filtros seleccionados.</div>';
                    return;
                }
                
                // Ordenar ingresos por fecha (m√°s recientes primero)
                ingresosFiltrados.sort((a, b) => new Date(b.fechaISO) - new Date(a.fechaISO));
                
                ingresosFiltrados.forEach(ingreso => {
                    const ingresoItem = document.createElement('div');
                    ingresoItem.className = 'ingreso-item';
                    ingresoItem.innerHTML = `
                        <div class="ingreso-fecha">${ingreso.fecha}</div>
                        <div class="ingreso-equipo">Equipo ${ingreso.equipoNumero}</div>
                        <div class="ingreso-cliente">${ingreso.clienteNombre}</div>
                        <div class="ingreso-monto">$${ingreso.monto.toFixed(2)}</div>
                        <div class="ingreso-info">${ingreso.descripcion}</div>
                        <button class="delete-btn" data-id="${ingreso.id}">üóëÔ∏è</button>
                    `;
                    
                    historialContainer.appendChild(ingresoItem);
                });
                
                // Agregar event listeners a los botones de eliminar
                document.querySelectorAll('.delete-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const id = this.getAttribute('data-id');
                        eliminarIngreso(id);
                    });
                });
            }
            
            // Funci√≥n para cargar dep√≥sitos por equipo
            function cargarDepositosPorEquipo() {
                const equipos = JSON.parse(localStorage.getItem('equiposMototaxis')) || [];
                const ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                const depositosContainer = document.getElementById('depositos-lista-equipos');
                const filtroEquipo = document.getElementById('filtro-equipo-depositos').value;
                
                // Limpiar contenedor
                depositosContainer.innerHTML = '';
                
                if (equipos.length === 0) {
                    depositosContainer.innerHTML = '<div class="empty-message">No hay equipos registrados.</div>';
                    return;
                }
                
                // Ordenar equipos por n√∫mero
                equipos.sort((a, b) => a.numero - b.numero);
                
                equipos.forEach(equipo => {
                    // Aplicar filtro si est√° activo
                    if (filtroEquipo && equipo.id !== filtroEquipo) {
                        return;
                    }
                    
                    const ingresosEquipo = ingresos.filter(ingreso => ingreso.equipoId === equipo.id);
                    
                    if (ingresosEquipo.length === 0) {
                        return; // No mostrar equipos sin ingresos
                    }
                    
                    // Ordenar ingresos por fecha (m√°s antiguos primero)
                    ingresosEquipo.sort((a, b) => new Date(a.fechaISO) - new Date(b.fechaISO));
                    
                    const totalEquipo = ingresosEquipo.reduce((sum, ingreso) => sum + ingreso.monto, 0);
                    
                    const equipoCard = document.createElement('div');
                    equipoCard.className = 'deposito-equipo-card depositos-print';
                    equipoCard.innerHTML = `
                        <div class="deposito-equipo-header">
                            <div class="deposito-equipo-numero">Equipo ${equipo.numero}</div>
                            <div class="deposito-equipo-total">Total: $${totalEquipo.toFixed(2)}</div>
                        </div>
                        <div class="deposito-equipo-info">${equipo.nombre} - ${equipo.placa}</div>
                        <div class="depositos-lista-equipo">
                            ${ingresosEquipo.map(ingreso => `
                                <div class="deposito-item">
                                    <div class="deposito-fecha">${ingreso.fecha}</div>
                                    <div class="deposito-monto">$${ingreso.monto.toFixed(2)}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="deposito-total">Total: $${totalEquipo.toFixed(2)}</div>
                        <button class="btn imprimir-btn no-print" onclick="imprimirEquipo(${equipo.numero})">Imprimir Equipo ${equipo.numero}</button>
                    `;
                    
                    depositosContainer.appendChild(equipoCard);
                });
                
                if (depositosContainer.children.length === 0) {
                    depositosContainer.innerHTML = '<div class="empty-message">No hay ingresos registrados para ning√∫n equipo.</div>';
                }
            }
            
            // Funci√≥n para cargar dep√≥sitos por cliente
            function cargarDepositosPorCliente() {
                const clientes = JSON.parse(localStorage.getItem('clientesMototaxis')) || [];
                const ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                const depositosContainer = document.getElementById('depositos-lista-clientes');
                const filtroCliente = document.getElementById('filtro-cliente-depositos').value;
                
                // Limpiar contenedor
                depositosContainer.innerHTML = '';
                
                if (clientes.length === 0) {
                    depositosContainer.innerHTML = '<div class="empty-message">No hay clientes registrados.</div>';
                    return;
                }
                
                // Ordenar clientes por nombre
                clientes.sort((a, b) => a.nombre.localeCompare(b.nombre));
                
                clientes.forEach(cliente => {
                    // Aplicar filtro si est√° activo
                    if (filtroCliente && cliente.id !== filtroCliente) {
                        return;
                    }
                    
                    const ingresosCliente = ingresos.filter(ingreso => ingreso.clienteId === cliente.id);
                    
                    if (ingresosCliente.length === 0) {
                        return; // No mostrar clientes sin ingresos
                    }
                    
                    // Ordenar ingresos por fecha (m√°s antiguos primero)
                    ingresosCliente.sort((a, b) => new Date(a.fechaISO) - new Date(b.fechaISO));
                    
                    const totalCliente = ingresosCliente.reduce((sum, ingreso) => sum + ingreso.monto, 0);
                    
                    const clienteCard = document.createElement('div');
                    clienteCard.className = 'deposito-cliente-card depositos-print';
                    clienteCard.innerHTML = `
                        <div class="deposito-cliente-header">
                            <div class="deposito-cliente-nombre">${cliente.nombre}</div>
                            <div class="deposito-cliente-total">Total: $${totalCliente.toFixed(2)}</div>
                        </div>
                        <div class="deposito-cliente-info">${cliente.telefono} - ${cliente.direccion}</div>
                        <div class="depositos-lista-cliente">
                            ${ingresosCliente.map(ingreso => `
                                <div class="deposito-item">
                                    <div class="deposito-fecha">${ingreso.fecha}</div>
                                    <div class="deposito-monto">$${ingreso.monto.toFixed(2)}</div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="deposito-total">Total: $${totalCliente.toFixed(2)}</div>
                        <button class="btn imprimir-btn no-print" onclick="imprimirCliente('${cliente.nombre}')">Imprimir ${cliente.nombre}</button>
                    `;
                    
                    depositosContainer.appendChild(clienteCard);
                });
                
                if (depositosContainer.children.length === 0) {
                    depositosContainer.innerHTML = '<div class="empty-message">No hay ingresos registrados para ning√∫n cliente.</div>';
                }
            }
            
            // Funci√≥n para imprimir un equipo espec√≠fico
            window.imprimirEquipo = function(numeroEquipo) {
                const equipoCard = document.querySelector(`.deposito-equipo-card .deposito-equipo-numero`).closest('.deposito-equipo-card');
                const contenido = equipoCard.outerHTML;
                
                const ventanaImpresion = window.open('', '_blank');
                ventanaImpresion.document.write(`
                    <html>
                        <head>
                            <title>Dep√≥sitos Equipo ${numeroEquipo}</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 20px; }
                                .deposito-equipo-card { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
                                .deposito-equipo-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
                                .deposito-equipo-numero { font-weight: bold; font-size: 18px; }
                                .deposito-equipo-total { font-weight: bold; color: #e74c3c; }
                                .deposito-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dashed #ccc; }
                                .deposito-total { margin-top: 10px; padding-top: 10px; border-top: 2px solid #27ae60; font-weight: bold; text-align: right; }
                            </style>
                        </head>
                        <body>
                            ${contenido}
                        </body>
                    </html>
                `);
                ventanaImpresion.document.close();
                ventanaImpresion.print();
            }
            
            // Funci√≥n para imprimir un cliente espec√≠fico
            window.imprimirCliente = function(nombreCliente) {
                const clienteCard = document.querySelector(`.deposito-cliente-card .deposito-cliente-nombre`).closest('.deposito-cliente-card');
                const contenido = clienteCard.outerHTML;
                
                const ventanaImpresion = window.open('', '_blank');
                ventanaImpresion.document.write(`
                    <html>
                        <head>
                            <title>Dep√≥sitos ${nombreCliente}</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 20px; }
                                .deposito-cliente-card { border: 1px solid #ccc; padding: 15px; margin-bottom: 20px; }
                                .deposito-cliente-header { display: flex; justify-content: space-between; margin-bottom: 10px; }
                                .deposito-cliente-nombre { font-weight: bold; font-size: 18px; }
                                .deposito-cliente-total { font-weight: bold; color: #e74c3c; }
                                .deposito-item { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dashed #ccc; }
                                .deposito-total { margin-top: 10px; padding-top: 10px; border-top: 2px solid #27ae60; font-weight: bold; text-align: right; }
                            </style>
                        </head>
                        <body>
                            ${contenido}
                        </body>
                    </html>
                `);
                ventanaImpresion.document.close();
                ventanaImpresion.print();
            }
            
            // Funci√≥n para eliminar un equipo
            async function eliminarEquipo(id) {
                if (!confirm('¬øEst√° seguro de que desea eliminar este equipo? Tambi√©n se eliminar√°n todos sus ingresos.')) {
                    return;
                }
                
                // Obtener equipos e ingresos
                let equipos = JSON.parse(localStorage.getItem('equiposMototaxis')) || [];
                let ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                
                // Eliminar equipo de Firebase
                const exitoFirebaseEquipo = await eliminarDeFirebase('equipos', id);
                
                // Eliminar ingresos del equipo de Firebase
                const ingresosAEliminar = ingresos.filter(ingreso => ingreso.equipoId === id);
                for (const ingreso of ingresosAEliminar) {
                    await eliminarDeFirebase('ingresos', ingreso.id);
                }
                
                // Eliminar equipo localmente
                equipos = equipos.filter(equipo => equipo.id !== id);
                localStorage.setItem('equiposMototaxis', JSON.stringify(equipos));
                
                // Eliminar ingresos del equipo localmente
                ingresos = ingresos.filter(ingreso => ingreso.equipoId !== id);
                localStorage.setItem('ingresosMototaxis', JSON.stringify(ingresos));
                
                // Actualizar interfaces
                actualizarSelectoresEquipos();
                actualizarResumenEquipos();
                actualizarResumenClientes();
                cargarListaEquipos();
                cargarHistorialIngresos();
                
                alert('Equipo eliminado correctamente.');
            }
            
            // Funci√≥n para eliminar un cliente
            async function eliminarCliente(id) {
                if (!confirm('¬øEst√° seguro de que desea eliminar este cliente? Tambi√©n se eliminar√°n todos sus ingresos.')) {
                    return;
                }
                
                // Obtener clientes e ingresos
                let clientes = JSON.parse(localStorage.getItem('clientesMototaxis')) || [];
                let ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                
                // Eliminar cliente de Firebase
                const exitoFirebaseCliente = await eliminarDeFirebase('clientes', id);
                
                // Eliminar ingresos del cliente de Firebase
                const ingresosAEliminar = ingresos.filter(ingreso => ingreso.clienteId === id);
                for (const ingreso of ingresosAEliminar) {
                    await eliminarDeFirebase('ingresos', ingreso.id);
                }
                
                // Eliminar cliente localmente
                clientes = clientes.filter(cliente => cliente.id !== id);
                localStorage.setItem('clientesMototaxis', JSON.stringify(clientes));
                
                // Eliminar ingresos del cliente localmente
                ingresos = ingresos.filter(ingreso => ingreso.clienteId !== id);
                localStorage.setItem('ingresosMototaxis', JSON.stringify(ingresos));
                
                // Actualizar interfaces
                actualizarSelectoresClientes();
                actualizarResumenEquipos();
                actualizarResumenClientes();
                cargarListaClientes();
                cargarHistorialIngresos();
                
                alert('Cliente eliminado correctamente.');
            }
            
            // Funci√≥n para eliminar un ingreso
            async function eliminarIngreso(id) {
                if (!confirm('¬øEst√° seguro de que desea eliminar este ingreso?')) {
                    return;
                }
                
                // Eliminar de Firebase
                const exito = await eliminarDeFirebase('ingresos', id);
                
                // Eliminar localmente
                let ingresos = JSON.parse(localStorage.getItem('ingresosMototaxis')) || [];
                ingresos = ingresos.filter(ingreso => ingreso.id !== id);
                localStorage.setItem('ingresosMototaxis', JSON.stringify(ingresos));
                
                // Actualizar interfaces
                actualizarResumenEquipos();
                actualizarResumenClientes();
                cargarHistorialIngresos();
                
                alert('Ingreso eliminado correctamente.');
            }
        });
    </script>
</body>
</html>